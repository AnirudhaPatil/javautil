<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_65) on Tue Aug 26 13:25:26 EDT 2014 -->
<title>ObjectLockSemaphore (javautil 3.1.2 API)</title>
<meta name="date" content="2014-08-26">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ObjectLockSemaphore (javautil 3.1.2 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/clapper/util/misc/ObjectExistsException.html" title="class in org.clapper.util.misc"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/clapper/util/misc/ObjectRemovalEvent.html" title="class in org.clapper.util.misc"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/clapper/util/misc/ObjectLockSemaphore.html" target="_top">Frames</a></li>
<li><a href="ObjectLockSemaphore.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.clapper.util.misc</div>
<h2 title="Class ObjectLockSemaphore" class="title">Class ObjectLockSemaphore</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.clapper.util.misc.ObjectLockSemaphore</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></dd>
</dl>
<hr>
<div class="block"><strong>Deprecated.</strong>&nbsp;
<div class="block"><i>J2SE 5.0 now provides a <tt>java.util.concurrent.Semaphore</tt> class</i></div>
</div>
<br>
<pre>public class <span class="strong">ObjectLockSemaphore</span>
extends java.lang.Object
implements <a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></pre>
<div class="block"><p><b>NOTE: This class, and its parent interface, are deprecated. With
 J2SE 5.0 (a.k.a., Java 1.5), the JDK provides its own semaphore class,
 <tt>java.util.concurrent.Semaphore</tt>.</b></p>

 <p>The <tt>ObjectLockSemaphore</tt> class implements the <a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc"><code>Semaphore</code></a>
 interface and provides a classic counting semaphore that uses the Java
 object-locking primitives (the same locking primitives used to implement
 synchronized critical sections) to ensure that
 <tt>ObjectLockSemaphore</tt> objects are atomically created, accessed,
 updated and destroyed.</p>

 <p><b>Warning:</b> Do not attempt to acquire or release a semaphore within
 a critical region--that is, within a "synchronized" section--or you'll
 risk deadlock. The <tt>Semaphore</tt> class is implemented using the
 Java VM's object monitor capability, the same capability that controls
 how synchronized sections work. The following code fragment is likely to
 cause a deadlock:</p>

 <blockquote>
 <pre>

 private ArrayList bufferPool = ...;
 private Semaphore sem = new ObjectLockSemaphore (bufferPool.size());

 public MyBuffer getBuffer()
 {
     MyBuffer result = null;

     synchronized (bufferPool)
     {
                                       // bufferPool is now locked
         sem.acquire();                // bufferPool is still locked
         result = (MyBuffer) bufferPool.removeElementAt (0);
     }

     return result;
 }

 public void returnBuffer (MyBuffer buf)
 {
     synchronized (bufferPool)
     {
                                       // bufferPool is now locked
         bufferPool.addElement (buf);
     }

     sem.release();                    // bufferPool is still locked
 }
 </pre>
 </blockquote>

 <p>Given the above code, assume:

 <ul>
    <li>The semaphore is initialized to the number of buffers in the pool.
    <li>All buffers are unavailable (i.e., have been handed out).
    <li>Thread A wants a buffer.
    <li>Thread B is using one, but is almost finished with it.
 </ul>

 <p>Here's how the deadlock can occur:</p>

 <ol>
    <li>Thread A calls the <tt>getBuffer()</tt> method.

    <li>Thread A enters the <tt>synchronized (bufferPool)</tt>
        block in <tt>getBuffer</tt>. As a result, Thread A acquires
        the Java monitor for the <tt>bufferPool</tt> object. Recall
        that only one thread can hold a given object's monitor at a time.

    <li>Thread A calls <tt>sem.acquire()</tt>. Since there are no
        buffers available, the semaphore's value is 0, so Thread A
        goes to sleep <b>while it is still holding the monitor lock
        on the <tt>bufferPool</tt> object.</b>

    <li>Thread B finishes with its buffer. It calls the
        <tt>returnBuffer()</tt> method.

    <li>Within <tt>returnBuffer()</tt>, Thread B attempts to acquire
        the monitor lock for the <tt>bufferPool</tt> object--but
        Thread A is already holding that lock, so Thread B goes to sleep,
        waiting for Thread A to release the lock.

    <li>Deadlock. Thread A is waiting for Thread B to release the semaphore.
        Thread B, in turn, is waiting for Thread A to release the lock
        on the <tt>bufferPool</tt> object.
 </ol>

 <p>This particular deadlock situation is easily avoided as shown:</p>

 <blockquote>
 <pre>

 private ArrayList bufferPool = ...;
 private Semaphore sem = new ObjectLockSemaphore (bufferPool.size());

 public MyBuffer getBuffer()
 {
     MyBuffer result = null;

     sem.acquire();
     synchronized (bufferPool)
     {
         result = (MyBuffer) bufferPool.removeElementAt (0);
     }

     return result;
 }

 public void returnBuffer (MyBuffer buf)
 {
     synchronized (bufferPool)
     {
                                       // bufferPool is now locked
         bufferPool.addElement (buf);
     }

     sem.release();                    // bufferPool is still locked
 }
 </pre>
 </blockquote></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#ObjectLockSemaphore(int)">ObjectLockSemaphore</a></strong>(int&nbsp;initialCount)</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Allocate a new semaphore with the specified initial count.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#acquire()">acquire</a></strong>()</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Acquire this semaphore.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#acquire(long)">acquire</a></strong>(long&nbsp;timeout)</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Acquire this semaphore.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#addToCount(int)">addToCount</a></strong>(int&nbsp;delta)</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Increment the semaphore's current value, as well as its maximum value.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#getValue()">getValue</a></strong>()</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Get the semaphore's current value (i.e., its count).</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#release()">release</a></strong>()</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Release this semaphore, incrementing its counter.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#toString()">toString</a></strong>()</code>
<div class="block"><strong>Deprecated.</strong>&nbsp;</div>
<div class="block">Return a string representation of the semaphore.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ObjectLockSemaphore(int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ObjectLockSemaphore</h4>
<pre>public&nbsp;ObjectLockSemaphore(int&nbsp;initialCount)</pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Allocate a new semaphore with the specified initial count.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>initialCount</code> - Initial semaphore count.</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="acquire(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>acquire</h4>
<pre>public&nbsp;boolean&nbsp;acquire(long&nbsp;timeout)
                throws <a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Acquire this semaphore. If the semaphore isn't available, the
 current thread is put to sleep until either (a) the semaphore is
 available, or (b) the timeout period expires.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/clapper/util/misc/Semaphore.html#acquire(long)">acquire</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>timeout</code> - Timeout period, in milliseconds. A value of 0 means
                 "wait forever, until the semaphore is available." A
                 negative value means "return immediately if the
                 semaphore is not available."</dd>
<dt><span class="strong">Returns:</span></dt><dd><tt>true</tt> if the semaphore was successfully acquired,
         <tt>false</tt> if the timeout expired.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></code> - error attempting to acquire semaphore</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#acquire()"><code>acquire()</code></a></dd></dl>
</li>
</ul>
<a name="acquire()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>acquire</h4>
<pre>public&nbsp;boolean&nbsp;acquire()
                throws <a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Acquire this semaphore. If the semaphore isn't available, this
 method waits forever for the semaphore to become available. Calling
 this version of <tt>acquire()</tt> is exactly equivalent to calling
 <a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#acquire(long)"><code>acquire(long)</code></a> with a timeout value of 0.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/clapper/util/misc/Semaphore.html#acquire()">acquire</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></code> - error attempting to acquire semaphore</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../org/clapper/util/misc/ObjectLockSemaphore.html#acquire(long)"><code>acquire(long)</code></a></dd></dl>
</li>
</ul>
<a name="addToCount(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addToCount</h4>
<pre>public&nbsp;void&nbsp;addToCount(int&nbsp;delta)
                throws <a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Increment the semaphore's current value, as well as its maximum value.
 This method is useful in cases where the semaphore is controlling
 access to multiple instances of a resource (e.g, database connections,
 file descriptors, etc.), and more instances of the controlled resource
 have become available.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/clapper/util/misc/Semaphore.html#addToCount(int)">addToCount</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>delta</code> - The amount by which to increment the count.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></code> - error updating semaphore's count</dd></dl>
</li>
</ul>
<a name="getValue()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getValue</h4>
<pre>public&nbsp;int&nbsp;getValue()
             throws <a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Get the semaphore's current value (i.e., its count).</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/clapper/util/misc/Semaphore.html#getValue()">getValue</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></code></dd>
<dt><span class="strong">Returns:</span></dt><dd>the current value of the semaphore</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></code> - error getting semaphore's value</dd></dl>
</li>
</ul>
<a name="release()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>release</h4>
<pre>public&nbsp;void&nbsp;release()
             throws <a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Release this semaphore, incrementing its counter.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/clapper/util/misc/Semaphore.html#release()">release</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../org/clapper/util/misc/Semaphore.html" title="interface in org.clapper.util.misc">Semaphore</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../org/clapper/util/misc/SemaphoreException.html" title="class in org.clapper.util.misc">SemaphoreException</a></code> - error getting semaphore's value</dd></dl>
</li>
</ul>
<a name="toString()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>toString</h4>
<pre>public&nbsp;java.lang.String&nbsp;toString()</pre>
<div class="block"><span class="strong">Deprecated.</span>&nbsp;</div>
<div class="block">Return a string representation of the semaphore.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code>toString</code>&nbsp;in class&nbsp;<code>java.lang.Object</code></dd>
<dt><span class="strong">Returns:</span></dt><dd>A printable representation of the semaphore.</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/clapper/util/misc/ObjectExistsException.html" title="class in org.clapper.util.misc"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/clapper/util/misc/ObjectRemovalEvent.html" title="class in org.clapper.util.misc"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/clapper/util/misc/ObjectLockSemaphore.html" target="_top">Frames</a></li>
<li><a href="ObjectLockSemaphore.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
